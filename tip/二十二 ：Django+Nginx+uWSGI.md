# django+nginx+uWSGI工作原理
   web服务器架构简述：

      用户请求-> 域名解析层（DNS）-> web服务层（Nginx，Apacha等）-> 应用服务层（uWGSI-django等）-> 数据库层（mysql-orcal等）-> 存储层（光纤存储磁盘等，很少有，贵）

   架构流程：

	客户端请求服务器资源，发送请求，DNS域名解析层解析域名，给Nginx分配ip（默认轮询分配）
	nginx作为直接对外的服务接口，接收到客户端发送过来的请求，会解包，分析
	如果是静态文件请求就根据nginx配置的静态文件目录，返回请求的资源
	如果是动态的请求，nginx就通过配置文件，将请求传递给uWSGI；uWSGI将接受到的包进行处理，并转发给wsgi，
	wsgi根据请求调用django工程的某个文件或者函数，处理完成后django将返回值交给wsgi
	wsgi将返回值进行打包，转发给uWSGI,
	uWSGI就收后转给nginx，nginx最终将返回值返回给客户端（如浏览器）；
### 1.Nginx -- web服务器
    1）Nginx是Apache的同行，Apache是世界第一大服务器，它的优点是稳定，开源，跨平台等，出现发展的时间很长，所以
         它被设计成一个重量级、不支持高并发的服务器。在Apache上运行数以万计的并发访问，会导致服务器消耗大量内存。
         操作系统对其进行进程或线程间的切换也消耗了大量的CPU资源，导致HTTP请求的平均响应速度降低，导致Apache不可
         能成为高性能web服务器。
    2）Nginx是一个俄罗斯工程师用c语言开发的，高性能轻量级的web服务器，也是反向代理服务器，与客户端（如浏览器）直接
         交互，收到客户端的请求（可能是大量），处理http协议和静态页面内容，
         请求按照一定的规则进行分发到不同的服务器进行处理，也就是刚才说的反
          向代理，起到负载均衡的作用。
      Nginx特点如下：
		      a.基于时间驱动框架，使得其可以支持数以百万级别的TCP连接；
		      b.高度的模块化和只有软件许可证使第三方模块层出不穷；
		      c.Nginx是一个跨平台的服务器，可以运行在linux,windows,freebsd,solaris,aix,mac os等操作系统；
		      d.极大的稳定性；
### 2.正、反向代理/负载均衡/'
    a. 正向代理：客户端非常明确要访问的服务器地址，但是并不能直接去访问，需要通过代理服务器，间接访问目标服务器，
                正向代理模式屏蔽或者萤火虫那个人真实客户端信息，所以目标服务器只知道请求来自哪个代理服务器但是并
                不知道具体的那个客户端；

    b. 反向代理：客户端并不知道反向代理的存在，反向代理服务器代理的是服务器端，主要是用于服务器集群分布式部署情况，
               反向代理隐藏了服务器的信息，它的作用是保证内网的安全，将反向代理作为公网访问地址，而真实的web服务
               器是内网，再一个作用就是负载均衡，通过反向代理服务器来优化网站的负载；
    
    c.负载均衡：
    将服务器接收到的请求按照一定的均衡规则分发给其他后端服务器处理的过程，称为负载均衡；
    在实际项目操作过程中，分为硬件和软件两种负载均衡；
    硬负载均衡：也称硬负载，如F5、A10负载均衡，是一个单独的硬件负载均衡服务器，相对造价昂贵成本较高，但是数据的稳
               定性安全性等有很好的保障，如中国移动联通这样的公司才会选择硬负载，

    更多的公司考虑到成本原因，会选择使用软件负载均衡，它是利用现有的技术结合主机硬件实现的一种消息队列分发机制。
    d.Nginx支持的负载均衡的调度算法方式:
      1）weight轮询（默认）：每个后端服务器都有一个接受请求的权重值（weight），默认情况下权重相同，当调整不
                           同服务器上请求的权重值后，权重大，几率大，权重值主要针对实际工作中不同的后端服务器的
                           硬件配置进行调整的，一般情况下不修改权重，因为一般服务器硬件都是相同的；
      2）ip_hash:按照每个请求ip地址的hash结果分配，这个算法每个ip地址的客户端总会访问同一个服务器，这在一定
                 程度上解决了集群部署环境下的session共享问题；
      3）fair:智能调度算法，动态的根据后端服务器请求处理的响应时间、处理效率来分配请求，结合了以上两种方法的优
              点，但是Nginx默认不支持fair算法，需要安装upstream_fair模块
      4）url_hash : 按照访问的url的hash结果分配请求，每个请求的url会指定后端固定的服务器，当Nginx作为静态服
                    务器时可以提高缓存效率。同样要注意的Nginx默认不支持，需要安装Nginx的hash软件包。
    
### 3.uWSGI-- 一种WSGI容器
	   1）wsgi是一种实现python解析的通用接口标准、协议，实现python web程序与服务器之间交互的通用性，利用wsgi，
              web.py或者django等等开发框架，就可以轻松的部署在不同的web服务器上；
	   2）uwsgi同WSGI一样是一种通信协议，是一个uWSGI服务器自有的协议，它用于定义传输信息的类型，它与WSGI相比是
              两样东西；
	   3）WSGI:在服务器上往往需要跑两个程序，一个是底层的server程序，一个是上层的
              Application,底层的server往往需要处理很多重复性很强，变化不大而又枯燥的工作，WSGI和Gunicorn就
              是一种成熟的解决方案，上层的Application部分，不同的应用差别就很大，无法一劳永逸的解决，但是python
              的web框架flask和django等是一些好的设计模式，server和application的交互，就遵循这个叫WSGI的协议、规范；
	   4）uWSGI是一种python web服务器，实现了uwsgi和WSGI、http等协议的web服务器，负责响应python的web请求，
             因为apache和nginx等，它们自己没有解析动态语言如php的功能，而是分派给其他模块来做，nginx中
             httpuwsgimodule的作用就是与uWSGI服务器进行交互；
### 4.作用：
	1）.虽然nginx并不是必须的，uwsgi完全可以完成整个的和浏览器交互的流程，但是在nginx上加上安全性或者其他的
        限制 ，可以达到保护程序的作用；
	2）.uWSGI是内网接口，开启多个work和processes可能也不够用，而nginx可以代理多台uWSGI完成uWSGI的负载均衡；
	3）.django在debug=False下对静态文件的处理能力不是很好，而用nginx来处理更加高效
